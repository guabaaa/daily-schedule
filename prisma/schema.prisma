generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
}

// 일정 타입 - 계획과 실행을 구분
enum ScheduleType {
  PLAN      // 계획
  EXECUTION // 실행
}

// 카테고리 (과목 등)
model Category {
  id        String     @id @default(uuid())
  name      String     // 예: "영어", "수학", "국어" 등
  color     String     // HEX 색상 코드
  schedules Schedule[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

// 메인 일정 테이블 - 계획과 실행을 모두 포함
model Schedule {
  id          String       @id @default(uuid())
  
  // 날짜 및 시간 정보
  date        DateTime     // 일정 날짜 (YYYY-MM-DD)
  startTimeMinutes Int      // 시작 시간 (분 단위, 0~1439, 예: 540 = 09:00, 1020 = 17:00)
  endTimeMinutes   Int      // 종료 시간 (분 단위, 0~1439)
  
  // 일정 타입 및 내용
  type        ScheduleType // PLAN 또는 EXECUTION
  title       String       // 일정 제목
  description String?      // 상세 설명 (선택)
  
  // 카테고리 및 색상
  categoryId  String?
  category    Category?    @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  customColor String?      // 카테고리 색상 외 커스텀 색상
  
  // 레이어링 및 겹침 처리
  layer       Int          @default(0) // 레이어 순서 (높을수록 위에 표시)
  zIndex      Int          @default(0) // z-index (겹칠 때 표시 우선순위)
  
  // 계획-실행 연결
  planId      String?      // 연관된 계획 ID (실행인 경우)
  plan        Schedule?    @relation("PlanExecution", fields: [planId], references: [id], onDelete: SetNull)
  executions  Schedule[]   @relation("PlanExecution")
  
  // 메타데이터
  completed   Boolean      @default(false) // 완료 여부
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  // 성능 최적화 인덱스
  @@index([date])
  @@index([type])
  @@index([categoryId])
  @@index([date, startTimeMinutes]) // 날짜+시간 복합 검색
  @@index([date, type]) // 날짜+타입 필터링
  @@index([date, completed]) // 날짜+완료 상태
  @@index([planId]) // 계획-실행 연결 조회
}
